<section>
  <form [formGroup]="apiKeyForm" (ngSubmit)="applyApiKey()">
    <!-- <button (click)="toggleApiKeyInfo()">&#8505;</button> TODO: excempt from submit, without moving out of form (forces newline) -->
    <span class="button" (click)="toggleApiKeyInfo()">&#8505;</span>
    <input type="text" placeholder="API Key" formControlName="apiKey"/>
    <button type="submit" class="button" [disabled]="!apiKeyForm.valid">Apply</button>
  </form>
  @if(showApiKeyInfo) {
    <p>
      Unsure what an API key is or how to create one?<br>
      <a href="https://wiki.guildwars2.com/wiki/API:API_key">https://wiki.guildwars2.com/wiki/API:API_key</a>
    </p>
    <p>
      Required permissions:
      @for(permission of bagsService.requiredApiKeyPermissions; track $index) {
        @if(missingPermissions().includes(permission)) {
          <span class="permissionMissing">{{permission}}</span>
        } @else {
          <span class="permission">{{permission}}</span>
        }
      }
    </p>
  }
</section>
<section class="row">
  <div>
    <table>
      <thead>
        <tr>
          <th>Character</th>
          <th>Used Slots</th>
          <th>Equipped Bags</th>
          <th>Available Bag Slots</th>
        </tr>
      </thead>
      <tbody>
        @if(bagsService.characters() == []) {
          loading character data
        }
        @for(character of bagsService.characters(); track $index) {
          <tr>
            <td>{{ character.name }}</td>
            <td>{{ character.usedInventorySlots() }} / {{ character.totalInventorySlots() }}</td>
            <td>
              <div class="bag-row">
              @for(bag of character.equippedBags; track $index) {
                <div class="bag-info"><app-bag-cell [bag]="bag"/></div>
              }
              </div>
            </td>
            <td>{{ character.emptyBagSlots }}</td>
          </tr>
        }
      </tbody>
    </table>
  </div>
  <div class="unused-bags">
    <div id="subheader">Available Bags</div>
    <div class="bag-grid">
      @for (bag of bagsService.unusedBags(); track $index) {
        <app-unused-bag-cell [bag]="bag" />
      }
    </div>
  </div>
</section>
